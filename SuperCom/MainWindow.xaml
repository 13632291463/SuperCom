<super:BaseWindow
    x:Class="SuperCom.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:config="clr-namespace:SuperCom.Config"
    xmlns:converter="clr-namespace:SuperCom.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:local="clr-namespace:SuperCom"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:super="https://github.com/SuperStudio/SuperControls"
    Name="mainWindow"
    Title="SuperCom-超级串口工具"
    Width="1200"
    Height="700"
    MinWidth="700"
    AutomationProperties.AutomationId="MainWindow"
    Background="{DynamicResource Window.Background}"
    Closing="mainWindow_Closing"
    ContentRendered="mainWindow_ContentRendered"
    Foreground="{DynamicResource Window.Foreground}"
    Icon="pack://application:,,,/Resources/Ico/ICON.ico"
    Loaded="mainWindow_Loaded"
    MenuAlign="Left"
    MenuMargin="200 0 0 0"
    ShowThemeSelector="True"
    TitleHeight="30"
    TitleMargin="5 0"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <super:BaseWindow.Resources>

        <ContextMenu x:Key="TextEditorContextMenu">
            <MenuItem Command="ApplicationCommands.SelectAll" Header="全选" />
            <MenuItem Command="ApplicationCommands.Copy" Header="复制" />
            <MenuItem Header="格式化">
                <MenuItem Click="FormatJson" Header="JSON(F2)" />
            </MenuItem>
            <MenuItem Header="编辑">
                <MenuItem Click="JoinLine" Header="合并为一行(F3)" />
            </MenuItem>
            <MenuItem Click="OpenHexTransform" Header="HEX 转换" />
            <MenuItem Click="OpenTimeTransform" Header="时间戳" />
        </ContextMenu>

        <Style x:Key="BgHoverBorder" TargetType="Border">
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="Background" Value="{DynamicResource Window.Title.Background}" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Opacity" Value="0.8" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Window.Title.Hover.Background}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <converter:ComboBoxSelectedIndexConverter x:Key="ComboBoxSelectedIndexConverter" />

    </super:BaseWindow.Resources>

    <Grid>
        <Popup
            x:Name="ForegroundPopup"
            AllowsTransparency="True"
            HorizontalOffset="-80"
            Placement="MousePoint"
            PopupAnimation="Fade"
            StaysOpen="True"
            VerticalOffset="0">
            <Grid Margin="5">
                <Border
                    Margin="5"
                    Background="{DynamicResource Menu.Background}"
                    CornerRadius="5"
                    Effect="{StaticResource PopupDropShadowEffect}" />
                <StackPanel Orientation="Vertical" Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContextMenu}}}">
                    <super:ColorPicker
                        Name="colorPicker"
                        SelectedColorChanged="colorPicker_SelectedColorChanged"
                        ShowColorPalette="False" />
                    <Button
                        Margin="5,0,5,10"
                        HorizontalAlignment="Center"
                        Click="CloseForegroundSelected"
                        Content="关闭"
                        Style="{StaticResource ButtonDanger}" />
                </StackPanel>
            </Grid>
        </Popup>




        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />

            </Grid.RowDefinitions>

            <Grid>
                <Menu x:Name="TopMenus">
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="文件"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem Click="OpenLog" Header="加载日志" />
                        <MenuItem
                            Click="SaveLog"
                            Header="日志另存为"
                            Icon="/Resources/Pictures/save.png" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem Click="ExportAllCmd" Header="导出配置" />
                        <MenuItem Click="ImportAllCmd" Header="导入配置" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem Click="OpenAppDir" Header="打开软件目录" />
                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="编辑"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Header="自动换行"
                            IsCheckable="True"
                            IsChecked="{Binding AutoWrap, Source={x:Static config:ConfigManager.Main}}" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Name="FontMenuItem"
                            Header="字体"
                            IsCheckable="False" />
                        <MenuItem
                            Click="OpenForegroundSelected"
                            Header="字体颜色"
                            IsCheckable="False" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="SetTextViewReturn"
                            Header="显示换行符"
                            IsCheckable="True"
                            IsChecked="{Binding ShowEndOfLine, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewSpace"
                            Header="显示空格"
                            IsCheckable="True"
                            IsChecked="{Binding ShowSpaces, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewTab"
                            Header="显示Tab"
                            IsCheckable="True"
                            IsChecked="{Binding ShowTabs, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextViewLineNumber"
                            Header="显示行号"
                            IsCheckable="True"
                            IsChecked="{Binding HighlightCurrentLine, Source={x:Static config:ConfigManager.Main}}" />
                        <MenuItem
                            Click="SetTextHighLightCurrent"
                            Header="高亮选中行"
                            IsCheckable="True"
                            IsChecked="{Binding ShowLineNumbers, Source={x:Static config:ConfigManager.Main}}" />
                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="视图"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Name="sideGridMenuItem"
                            Click="HideSide"
                            Header="侧边栏"
                            IsCheckable="True"
                            IsChecked="True" />
                        <!--<MenuItem
                                            Header="右侧功能栏"
                                            IsCheckable="True"
                                            IsChecked="{Binding ShowRightPanel, Source={x:Static config:ConfigManager.Main}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />-->

                    </MenuItem>
                    <MenuItem
                        Background="{DynamicResource Window.Title.Background}"
                        Header="工具"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            Click="OpenSetting"
                            Header="设置"
                            Icon="/Resources/Pictures/setting.png" />

                        <MenuItem Click="OpenShortCut" Header="快捷键" />
                        <MenuItem Click="ShowPluginWindow" Header="插件" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="ShowVarMonitor"
                            Header="监视器"
                            Visibility="Collapsed" />
                        <MenuItem Click="ShowVirtualPort" Header="虚拟串口模拟" />
                        <Separator Margin="-20,5,10,5" />
                        <MenuItem
                            Click="ShowAscii"
                            Header="ASCII 表"
                            IsCheckable="False" />
                        <MenuItem
                            Click="ShowReferences"
                            Header="参考文献"
                            IsCheckable="False" />
                    </MenuItem>
                    <MenuItem
                        AutomationProperties.AutomationId="MenuItem_About"
                        Background="{DynamicResource Window.Title.Background}"
                        Header="关于"
                        Style="{StaticResource TopMenuItemStyle}">
                        <MenuItem
                            AutomationProperties.AutomationId="MenuItem_ShowUpgrade"
                            Click="ShowUpgradeWindow"
                            Header="检查更新"
                            Icon="/Resources/Pictures/update.png" />
                        <MenuItem
                            Click="ShowAbout"
                            Header="关于"
                            Icon="/Resources/Pictures/about.png" />
                        <MenuItem Click="OpenFeedBack" Header="反馈" />
                        <MenuItem Click="OpenHelp" Header="帮助" />
                        <MenuItem Click="OpenHFAQ" Header="常见问题" />
                        <MenuItem
                            Click="OpenDevelop"
                            Header="参与开发"
                            Icon="/Resources/Pictures/develop.png" />

                    </MenuItem>

                </Menu>
            </Grid>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        Name="SideGridColumn"
                        Width="{Binding SideGridWidth, FallbackValue=200, Mode=OneWay}"
                        MaxWidth="500" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>

                <Grid
                    Grid.ColumnSpan="10"
                    Panel.ZIndex="99"
                    Visibility="{Binding DoingLongWork, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
                    <Border Background="{DynamicResource Window.Title.Background}" Opacity="0.7" />
                    <Grid>
                        <Border
                            Width="200"
                            Height="200"
                            Background="{DynamicResource Window.Side.Background}"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <StackPanel
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Orientation="Vertical">
                            <super:LoadingCircle Width="40" Height="40" />
                            <TextBlock
                                Margin="10"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{Binding DoingWorkMsg}" />
                        </StackPanel>
                    </Grid>
                </Grid>

                <Border
                    Name="sideBorder"
                    Grid.Column="0"
                    Background="{DynamicResource Window.Side.Background}"
                    SizeChanged="Border_SizeChanged">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />

                            </Grid.ColumnDefinitions>
                            <Border
                                Margin="5"
                                MouseLeftButtonUp="RefreshPortsStatus"
                                Style="{StaticResource RoundHoverBorder}">
                                <Viewbox Width="auto" Height="14">
                                    <Path
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="M848.738462 608.137846c-8.467692 178.097231-155.963077 319.881846-336.659693 319.881846-186.171077 0-337.132308-150.449231-337.132307-336.068923 0-180.145231 142.178462-327.168 320.787692-335.675077v159.82277l353.122461-192.039385L495.734154 0v160.098462C263.995077 168.684308 78.769231 358.754462 78.769231 591.872 78.769231 830.542769 272.777846 1024 512.157538 1024 746.062769 1024 936.644923 839.286154 945.230769 608.137846h-96.492307z"
                                        Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </Border>

                            <Border
                                Grid.Column="1"
                                MouseUp="ShowContextMenu"
                                Style="{StaticResource RoundHoverBorder}">
                                <Border.ContextMenu>
                                    <ContextMenu HorizontalOffset="-50">

                                        <MenuItem Click="OpenAllPort" Header="打开所有串口" />
                                        <MenuItem Click="CloseAllPort" Header="关闭所有串口" />
                                        <MenuItem Click="ShowAllHidePort" Header="显示隐藏的串口" />
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <Viewbox
                                    Width="auto"
                                    Height="14"
                                    Margin="-2,-2,0,0">
                                    <Path
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16z m-52 268H212V212h200v200z m452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16z m-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z m-52 268H212V612h200v200z m452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z m-52 268H612V612h200v200z"
                                        Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </Border>
                            <Border
                                Grid.Column="2"
                                MouseUp="ShowContextMenu"
                                Style="{StaticResource RoundHoverBorder}"
                                ToolTip="排序">
                                <Border.ContextMenu>
                                    <ContextMenu HorizontalOffset="-50">

                                        <MenuItem
                                            super:MenuItemExt.Desc="False"
                                            super:MenuItemExt.Sortable="True"
                                            Click="SortSidePorts"
                                            Header="按添加顺序"
                                            Style="{StaticResource SortMenuItemStyle}"
                                            Tag="AddTime" />
                                        <MenuItem
                                            Click="SortSidePorts"
                                            Header="按串口名"
                                            Style="{StaticResource SortMenuItemStyle}"
                                            Tag="PortName" />
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <Viewbox Width="auto" Height="14">
                                    <Path
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="M768 362.666667a21.333333 21.333333 0 0 1 21.333333 21.333333v387.648l61.418667-61.397333a21.333333 21.333333 0 0 1 30.165333 0l30.165334 30.165333a21.333333 21.333333 0 0 1 0 30.165333l-116.053334 116.053334a53.333333 53.333333 0 0 1-90.922666-34.218667L704 848.917333V384a21.333333 21.333333 0 0 1 21.333333-21.333333h42.666667zM554.666667 789.333333a21.333333 21.333333 0 0 1 21.333333 21.333334v42.666666a21.333333 21.333333 0 0 1-21.333333 21.333334H128a21.333333 21.333333 0 0 1-21.333333-21.333334v-42.666666a21.333333 21.333333 0 0 1 21.333333-21.333334h426.666667z m0-320a21.333333 21.333333 0 0 1 21.333333 21.333334v42.666666a21.333333 21.333333 0 0 1-21.333333 21.333334H128a21.333333 21.333333 0 0 1-21.333333-21.333334v-42.666666a21.333333 21.333333 0 0 1 21.333333-21.333334h426.666667zM896 149.333333a21.333333 21.333333 0 0 1 21.333333 21.333334v42.666666a21.333333 21.333333 0 0 1-21.333333 21.333334H128a21.333333 21.333333 0 0 1-21.333333-21.333334V170.666667a21.333333 21.333333 0 0 1 21.333333-21.333334h768z"
                                        Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </Border>

                            <!--<Image
                                Grid.Column="0"
                                Width="24"
                                Height="24"
                                Margin="5,0"
                                HorizontalAlignment="Left"
                                Source="{Binding Icon, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                Stretch="UniformToFill" />-->


                        </Grid>
                        <ListBox
                            Grid.Row="1"
                            HorizontalContentAlignment="Stretch"
                            d:ItemsSource="{d:SampleData ItemCount=5}"
                            Background="Transparent"
                            ItemsSource="{Binding SideComPorts}"
                            ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                            Style="{StaticResource NormalListBox}">
                            <ListBox.ItemContainerStyle>
                                <Style BasedOn="{StaticResource BaseListBoxItem}" TargetType="{x:Type ListBoxItem}">
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="Background" Value="Transparent" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Hide}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,2"
                                        Background="{DynamicResource ListBoxItem.Background}"
                                        CornerRadius="5">
                                        <Grid
                                            Background="Transparent"
                                            PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown"
                                            Tag="{Binding Name}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem
                                                        Click="Remark"
                                                        Header="备注"
                                                        Icon="/Resources/Pictures/remark.png" />
                                                    <MenuItem Click="HidePort" Header="隐藏" />
                                                </ContextMenu>
                                            </Grid.ContextMenu>
                                            <Border
                                                Grid.Column="0"
                                                Width="10"
                                                Height="10"
                                                Margin="5"
                                                CornerRadius="10">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="Green" />
                                                        <Style.Triggers>

                                                            <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                <Setter Property="Background" Value="Red" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                            </Border>
                                            <TextBlock
                                                Grid.Column="1"
                                                MaxWidth="120"
                                                Margin="0"
                                                Padding="10,5"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Name}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="WrapWithOverflow" />
                                            <TextBlock
                                                Grid.Column="2"
                                                MaxWidth="120"
                                                Margin="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                FontSize="12"
                                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Remark, UpdateSourceTrigger=PropertyChanged}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="WrapWithOverflow" />
                                            <Button
                                                Grid.Column="3"
                                                Margin="5"
                                                HorizontalAlignment="Right"
                                                Click="ConnectPort"
                                                Tag="{Binding Name}">
                                                <Button.Style>
                                                    <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                        <Setter Property="Content" Value="连接" />
                                                        <Setter Property="Visibility" Value="Hidden" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Connected}" Value="True">

                                                                <Setter Property="Content" Value="断开" />
                                                                <Setter Property="Background" Value="Red" />
                                                                <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                            </DataTrigger>

                                                            <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Grid}, Mode=FindAncestor}}" Value="true">
                                                                <Setter Property="Visibility" Value="Visible" />
                                                            </DataTrigger>

                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>





                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Padding="10,0"
                                VerticalAlignment="Center"
                                FontSize="15"
                                FontWeight="Bold"
                                Foreground="Gold"
                                Text="SuperCom" />
                            <Border
                                Grid.Column="1"
                                Width="30"
                                Height="30"
                                Margin="5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                CornerRadius="5"
                                MouseUp="ShowSettingsPopup"
                                Style="{StaticResource HoverBorder}">
                                <Border.ContextMenu>
                                    <ContextMenu HorizontalOffset="-40">
                                        <MenuItem
                                            Click="OpenSetting"
                                            Header="设置"
                                            Icon="/Resources/Pictures/setting.png" />
                                        <MenuItem Click="ShowPluginWindow" Header="插件" />
                                        <MenuItem
                                            Click="ShowUpgradeWindow"
                                            Header="检查更新"
                                            Icon="/Resources/Pictures/update.png" />
                                        <MenuItem
                                            Click="ShowAbout"
                                            Header="关于"
                                            Icon="/Resources/Pictures/about.png" />
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <Viewbox
                                    Width="20"
                                    Height="auto"
                                    VerticalAlignment="Center">
                                    <Path Data="M940 596l-76-57.6c0.8-8 1.6-16.8 1.6-26.4s-0.8-18.4-1.6-26.4l76-57.6c20.8-16 26.4-44 12.8-68l-84.8-143.2c-9.6-16.8-28-27.2-47.2-27.2-6.4 0-12 0.8-18.4 3.2L712 228c-15.2-10.4-31.2-19.2-47.2-26.4l-13.6-92c-4-26.4-26.4-45.6-53.6-45.6H426.4c-27.2 0-49.6 19.2-53.6 44.8L360 201.6c-16 7.2-31.2 16-47.2 26.4l-90.4-35.2c-6.4-2.4-12.8-3.2-19.2-3.2-19.2 0-37.6 9.6-46.4 26.4L71.2 360c-13.6 22.4-8 52 12.8 68l76 57.6c-0.8 9.6-1.6 18.4-1.6 26.4s0 16.8 1.6 26.4l-76 57.6c-20.8 16-26.4 44-12.8 68l84.8 143.2c9.6 16.8 28 27.2 47.2 27.2 6.4 0 12-0.8 18.4-3.2L312 796c15.2 10.4 31.2 19.2 47.2 26.4l13.6 92c3.2 25.6 26.4 45.6 53.6 45.6h171.2c27.2 0 49.6-19.2 53.6-44.8l13.6-92.8c16-7.2 31.2-16 47.2-26.4l90.4 35.2c6.4 2.4 12.8 3.2 19.2 3.2 19.2 0 37.6-9.6 46.4-26.4l85.6-144.8c12.8-23.2 7.2-51.2-13.6-67.2zM704 512c0 105.6-86.4 192-192 192S320 617.6 320 512s86.4-192 192-192 192 86.4 192 192z" Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
                <GridSplitter
                    Grid.Column="1"
                    Width="4"
                    HorizontalAlignment="Left"
                    Panel.ZIndex="10"
                    Style="{StaticResource HoverSpliter}" />

                <Popup
                    x:Name="editSendCommandPopup"
                    Width="300"
                    Height="400"
                    Margin="0,0,700,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="True"
                    VerticalOffset="-80">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>
                            <TextBlock
                                Margin="5,20,5,5"
                                FontWeight="Bold"
                                Style="{StaticResource BaseTextBlock}"
                                Text="编辑命令" />

                            <DockPanel
                                Grid.Row="1"
                                Margin="10"
                                LastChildFill="True">
                                <DockPanel DockPanel.Dock="Top" LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="顺序" />
                                    <super:SearchBox Name="editTextBoxOrder" Margin="0,5" />
                                </DockPanel>
                                <DockPanel
                                    VerticalAlignment="Top"
                                    DockPanel.Dock="Top"
                                    LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="名称" />
                                    <super:SearchBox Name="editTextBoxName" Margin="0,5" />
                                </DockPanel>
                                <DockPanel
                                    VerticalAlignment="Top"
                                    DockPanel.Dock="Top"
                                    LastChildFill="True">
                                    <TextBlock
                                        MinWidth="50"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="延时" />

                                    <super:SearchBox Name="editTextBoxDelay" Margin="0,5" />

                                </DockPanel>

                                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">



                                    <TextBlock
                                        MinWidth="50"
                                        HorizontalAlignment="Left"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="命令" />

                                    <Button
                                        Grid.Column="0"
                                        Width="25"
                                        Height="25"
                                        Margin="0,0,5,0"
                                        Padding="0"
                                        VerticalAlignment="Stretch"
                                        super:CommonExt.CornerRadius="5"
                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                        Click="CopyCommand"
                                        Style="{StaticResource FlatButton}">
                                        <Viewbox Width="auto" Height="14">
                                            <Path
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="M891.072 822.144V167.36a34.432 34.432 0 0 0-34.432-34.432H201.856C201.856 94.848 232.704 64 270.784 64h620.288C929.152 64 960 94.848 960 132.928v620.288c0 38.08-30.848 68.928-68.928 68.928z m-68.928-551.36v620.288c0 38.08-30.848 68.928-68.928 68.928H132.928A68.928 68.928 0 0 1 64 891.072V270.784c0-38.08 30.848-68.928 68.928-68.928h620.288c38.08 0 68.928 30.848 68.928 68.928z m-137.856 137.856H201.856a34.432 34.432 0 0 0 0 68.864h482.432a34.432 34.432 0 0 0 0-68.864z m0 206.72H201.856a34.432 34.432 0 0 0 0 68.864h482.432a34.432 34.432 0 0 0 0-68.864z"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Viewbox>
                                    </Button>
                                </StackPanel>
                                <Border
                                    Margin="15,5,5,5"
                                    Padding="5"
                                    Background="{DynamicResource Window.Title.Background}"
                                    BorderThickness="1"
                                    CornerRadius="3">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ElementName=editTextBoxCommand, Path=IsFocused}" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBox
                                        Name="editTextBoxCommand"
                                        Padding="2,0,0,0"
                                        HorizontalAlignment="Stretch"
                                        VerticalContentAlignment="Top"
                                        AcceptsReturn="False"
                                        Background="Transparent"
                                        ContextMenu="{StaticResource TextBoxContextMenu}"
                                        FontSize="12"
                                        Style="{StaticResource BaseTextBox}"
                                        Text=""
                                        TextAlignment="Left"
                                        TextWrapping="Wrap" />
                                </Border>

                            </DockPanel>

                            <StackPanel
                                Grid.Row="2"
                                Margin="5"
                                HorizontalAlignment="Center"
                                Orientation="Horizontal">
                                <Button
                                    Margin="5"
                                    Click="EditCommandConfirm"
                                    Content="确认"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5"
                                    Click="EditCommandCancel"
                                    Content="取消"
                                    Style="{StaticResource ButtonDanger}" />
                            </StackPanel>
                        </Grid>

                    </Grid>
                </Popup>

                <Popup
                    x:Name="hexTransPopup"
                    Grid.ColumnSpan="3"
                    Width="300"
                    Height="auto"
                    Margin="0,0,700,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="False"
                    VerticalOffset="-80">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Grid.Row="0"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="HEX" />
                                <super:Switch
                                    Name="HexToStrSwitch"
                                    Height="16"
                                    Margin="20,0,5,0"
                                    VerticalAlignment="Center"
                                    BorderBrush="{DynamicResource Window.Title.Background}"
                                    Click="Switch_Click" />
                                <TextBlock
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Style="{StaticResource BaseTextBlock}"
                                    Text="大写" />
                                <Button
                                    Margin="5,2"
                                    Padding="4"
                                    VerticalAlignment="Center"
                                    Click="ClearHexSpace"
                                    Content="清除空格"
                                    FontSize="10" />


                            </StackPanel>
                            <ToggleButton
                                Width="auto"
                                Height="auto"
                                Margin="5,0"
                                Padding="2,2,4,2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                Click="SetStayOpenStatus"
                                Style="{StaticResource FlatToggleButton}">
                                <Viewbox
                                    Width="15"
                                    Height="auto"
                                    VerticalAlignment="Center">
                                    <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </ToggleButton>

                            <Border
                                Grid.Row="1"
                                Margin="0,10"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="HexTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>



                            <TextBlock
                                Grid.Row="2"
                                FontWeight="Bold"
                                Text="字符串" />

                            <Border
                                Grid.Row="3"
                                Margin="0,10,0,0"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="StrTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>

                            <WrapPanel
                                Grid.Row="4"
                                Margin="0,10"
                                Orientation="Horizontal">
                                <Button
                                    Margin="0,0,5,0"
                                    Click="HexToStr"
                                    Content="Hex =&gt; Str"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5,0"
                                    Click="StrToHex"
                                    Content="Str =&gt; Hex"
                                    Style="{StaticResource ButtonPrimary}" />
                            </WrapPanel>

                        </Grid>

                    </Grid>
                </Popup>
                <Popup
                    x:Name="timeTransPopup"
                    Grid.ColumnSpan="3"
                    Width="330"
                    Height="auto"
                    Margin="0,0,670,0"
                    AllowsTransparency="True"
                    HorizontalOffset="-150"
                    Placement="Mouse"
                    PopupAnimation="Fade"
                    StaysOpen="False"
                    VerticalOffset="-120">
                    <Grid Margin="5">
                        <Border
                            Margin="5"
                            Background="{DynamicResource Menu.Background}"
                            CornerRadius="5"
                            Effect="{StaticResource PopupDropShadowEffect}" />
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Grid.Row="0"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="时间戳" />

                                <ComboBox
                                    Name="TimeComboBox"
                                    Width="100"
                                    Margin="20,0"
                                    FontSize="10"
                                    SelectedIndex="0"
                                    Style="{StaticResource BorderComboBox}">
                                    <ComboBoxItem Content="秒(s)" />
                                    <ComboBoxItem Content="毫秒(ms)" />
                                </ComboBox>


                            </StackPanel>

                            <ToggleButton
                                Width="auto"
                                Height="auto"
                                Margin="5,0"
                                Padding="2,2,4,2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                Click="SetStayOpenStatus"
                                Style="{StaticResource FlatToggleButton}">
                                <Viewbox
                                    Width="15"
                                    Height="auto"
                                    VerticalAlignment="Center">
                                    <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                </Viewbox>
                            </ToggleButton>

                            <Border
                                Grid.Row="1"
                                Margin="0,10"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="TimeStampTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>



                            <TextBlock
                                Grid.Row="2"
                                FontWeight="Bold"
                                Text="北京时间" />

                            <Border
                                Grid.Row="3"
                                Margin="0,10,0,0"
                                Padding="5"
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5">
                                <TextBox
                                    Name="LocalTimeTextBox"
                                    Grid.Row="1"
                                    MaxHeight="100"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    ContextMenu="{StaticResource TextBoxContextMenu}"
                                    Style="{StaticResource MultiLineTextBox}"
                                    VerticalScrollBarVisibility="Auto" />
                            </Border>

                            <WrapPanel
                                Grid.Row="4"
                                Margin="0,10"
                                Orientation="Horizontal">
                                <Button
                                    Margin="0,0,5,0"
                                    Click="TimeStampToLocalTime"
                                    Content="时间戳 =&gt; 北京时间"
                                    Style="{StaticResource ButtonPrimary}" />
                                <Button
                                    Margin="5,0"
                                    Click="LocalTimeToTimeStamp"
                                    Content="北京时间 =&gt; 时间戳"
                                    Style="{StaticResource ButtonPrimary}" />
                            </WrapPanel>

                        </Grid>

                    </Grid>
                </Popup>


                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <super:NoticeViewer x:Name="noticeViewer" Grid.Row="0" />

                    <StackPanel
                        Grid.RowSpan="3"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Vertical"
                        Visibility="{Binding ShowSoft, Converter={StaticResource BoolToVisibilityConverter}}">

                        <Image
                            Grid.Row="0"
                            Height="128"
                            Margin="10"
                            Source="pack://application:,,,/Resources/Ico/ICON_256.png">
                            <Image.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </Image.Effect>
                        </Image>
                        <TextBlock
                            Grid.Row="1"
                            FontSize="25"
                            Style="{StaticResource BaseTextBlock}"
                            Text="欢迎使用 SuperCom">
                            <TextBlock.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </TextBlock.Effect>
                        </TextBlock>
                        <TextBlock
                            Grid.Row="2"
                            FontSize="15"
                            Foreground="{DynamicResource Window.Sub.Foreground}"
                            Style="{StaticResource BaseTextBlock}"
                            Text="@SuperStudio Copyright © 2022">
                            <TextBlock.Effect>
                                <DropShadowEffect
                                    BlurRadius="4"
                                    Direction="315"
                                    Opacity="1"
                                    ShadowDepth="5"
                                    Color="Black" />
                            </TextBlock.Effect>
                        </TextBlock>
                    </StackPanel>

                    <!--  选项 tabitem 栏  -->
                    <ScrollViewer
                        Grid.Row="1"
                        HorizontalScrollBarVisibility="Auto"
                        PreviewMouseWheel="PortTab_PreviewMouseWheel"
                        VerticalScrollBarVisibility="Hidden">
                        <ItemsControl Name="tabItemsControl" ItemsSource="{Binding PortTabItems}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Height="35"
                                        MinWidth="150"
                                        BorderThickness="1"
                                        Cursor="Hand"
                                        PreviewMouseLeftButtonDown="BeginDragTabItem"
                                        PreviewMouseLeftButtonUp="SetPortSelected"
                                        PreviewMouseMove="Border_PreviewMouseMove"
                                        Tag="{Binding Name}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="{DynamicResource TabItem.Background}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Selected}" Value="True">
                                                        <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.Background}" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Border.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem
                                                    Click="CloseAllConnectPort"
                                                    Header="断开所有"
                                                    Icon="/Resources/Pictures/closeport.png" />
                                                <Separator />
                                                <MenuItem Click="CloseCurrentPort" Header="关闭" />
                                                <MenuItem Click="CloseOtherPort" Header="关闭其它" />
                                                <MenuItem Click="CloseAllLeftPort" Header="关闭左边所有" />
                                                <MenuItem Click="CloseAllRightPort" Header="关闭右边所有" />
                                                <MenuItem Click="CloseAllPorts" Header="关闭所有" />
                                                <Separator />
                                                <MenuItem Click="MoveToFirst" Header="移到最前" />
                                                <MenuItem Click="MoveToLast" Header="移到最后" />
                                                <Separator />
                                                <MenuItem
                                                    Click="PinPort"
                                                    Header="固定"
                                                    IsCheckable="True"
                                                    IsChecked="{Binding Pinned, Mode=OneWay}" />
                                                <Separator />
                                                <MenuItem
                                                    Click="Remark"
                                                    Header="备注"
                                                    Icon="/Resources/Pictures/remark.png" />
                                            </ContextMenu>
                                        </Border.ContextMenu>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <Border
                                                Grid.Column="0"
                                                Width="10"
                                                Height="10"
                                                Margin="5"
                                                CornerRadius="10">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="Green" />
                                                        <Style.Triggers>

                                                            <DataTrigger Binding="{Binding Connected}" Value="True">
                                                                <Setter Property="Background" Value="Red" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                            </Border>
                                            <TextBlock
                                                Grid.Column="1"
                                                MaxWidth="120"
                                                Margin="0"
                                                Padding="10,5"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Name}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="WrapWithOverflow" />
                                            <TextBlock
                                                Grid.Column="2"
                                                MaxWidth="50"
                                                Margin="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                FontSize="12"
                                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{Binding Remark}"
                                                TextTrimming="WordEllipsis"
                                                TextWrapping="WrapWithOverflow" />

                                            <Grid Grid.Column="3">
                                                <Border
                                                    Panel.ZIndex="2"
                                                    Background="Transparent"
                                                    BorderBrush="{StaticResource TabItem.Selected.Background}"
                                                    PreviewMouseLeftButtonDown="PinTabItem"
                                                    Visibility="{Binding Pinned, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Button
                                                        Width="20"
                                                        Height="20"
                                                        Margin="5"
                                                        HorizontalAlignment="Right"
                                                        Background="Transparent"
                                                        Style="{StaticResource RoundNormalButton}"
                                                        Tag="{DynamicResource TabItem.Hover.Background}">
                                                        <Viewbox
                                                            Width="10"
                                                            Height="auto"
                                                            Margin="-2.5,2,0,0"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M393.846154 64.174932l117.454119 0.399843H512.499805l117.454119-0.399843-10.395939 10.395939c-18.89262 18.89262-28.488872 44.982429-26.28973 71.472081l20.292073 250.502148c2.998829 36.68567 18.092932 72.171808 42.483405 99.661069l34.186646 38.684889-122.252245-0.899648-55.478329-0.399844h-0.99961l-55.478329 0.399844-122.452167 0.799687 34.186646-38.684888c24.390472-27.589223 39.484576-62.9754 42.483405-99.66107l20.292074-250.402187c2.199141-26.589613-7.397111-52.679422-26.289731-71.472081l-10.395939-10.395939m281.889887-64.174932h-0.199922L512.399844 0.599766h-0.799688L348.36392 0h-0.199922c-20.891839 0-39.684498 13.494729-45.582194 33.58688-4.098399 13.994533-1.899258 30.887934 17.79305 47.581414l38.584927 38.584927c5.597813 5.597813 8.39672 13.294807 7.796955 21.091761L346.464662 391.247169c-1.899258 23.190941-11.195627 45.08239-26.589613 62.475596l-61.87583 69.872706c-8.696603 9.796173-13.894572 22.291292-14.394377 35.386177-0.299883 8.996486 1.599375 18.89262 8.596642 27.28934 6.897306 8.296759 17.293245 12.894963 27.989067 12.894963h0.299882l175.931277-1.199532 55.178446 422.834831 0.399844 3.098789 0.399844-3.098789 55.178446-422.834831 175.931277 1.199532h0.299882c10.795783 0 21.191722-4.598204 27.989067-12.894963 6.897306-8.39672 8.796564-18.292854 8.596642-27.28934-0.399844-13.094885-5.697774-25.590004-14.394377-35.386177l-61.87583-69.872706c-15.393987-17.393206-24.690355-39.284654-26.589613-62.475596l-20.292074-250.402187c-0.599766-7.796954 2.199141-15.593909 7.796955-21.091761l38.584927-38.584927c19.692308-16.693479 21.891449-33.58688 17.79305-47.581414-5.997657-19.992191-24.790316-33.58688-45.682155-33.58688z"
                                                                Fill="{DynamicResource TabItem.Hover.Foreground}" />
                                                        </Viewbox>
                                                    </Button>
                                                </Border>
                                                <Border
                                                    x:Name="border"
                                                    Background="Transparent"
                                                    BorderBrush="{StaticResource TabItem.Selected.Background}"
                                                    PreviewMouseLeftButtonDown="CloseTabItem"
                                                    Visibility="{Binding Pinned, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                                                    <Button
                                                        Width="20"
                                                        Height="20"
                                                        Margin="5"
                                                        HorizontalAlignment="Right"
                                                        Style="{StaticResource RoundNormalButton}"
                                                        Tag="{DynamicResource TabItem.Hover.Background}">
                                                        <Viewbox
                                                            Width="10"
                                                            Height="auto"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M610.218667 505.6l398.08-387.413333a49.664 49.664 0 0 0 0-71.338667l-2.133334-2.133333a52.992 52.992 0 0 0-73.301333 0L534.784 432.64 136.704 44.373333a52.992 52.992 0 0 0-73.386667 0L61.269333 46.592a48.810667 48.810667 0 0 0 0 71.338667l398.165334 387.669333-398.165334 387.498667a49.664 49.664 0 0 0 0 71.253333l2.218667 2.133333c20.48 19.626667 52.821333 19.626667 73.301333 0l398.08-387.413333 398.08 387.413333c20.48 19.626667 52.906667 19.626667 73.386667 0l2.048-2.133333a49.664 49.664 0 0 0 0-71.253333l-398.08-387.413334z"
                                                                Fill="{DynamicResource TabItem.Hover.Foreground}" />
                                                        </Viewbox>
                                                    </Button>
                                                </Border>
                                            </Grid>


                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <ItemsControl
                        Name="itemsControl"
                        Grid.Row="2"
                        Background="Transparent"
                        ItemsSource="{Binding PortTabItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Grid />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>



                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Name="baseGrid"
                                    PreviewKeyDown="baseGrid_PreviewKeyDown"
                                    Tag="{Binding Name}"
                                    Visibility="{Binding Selected, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" MinHeight="100" />
                                        <RowDefinition Height="5" />
                                        <RowDefinition Height="auto" MaxHeight="300" />
                                    </Grid.RowDefinitions>


                                    <Grid
                                        Name="rootGrid"
                                        Grid.Row="0"
                                        Tag="{Binding Name}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <Border
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            Margin="0,0,5,0"
                                            Padding="10"
                                            Background="{DynamicResource TabItem.Background}"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            PreviewMouseWheel="Border_PreviewMouseWheel">
                                            <avalonEdit:TextEditor
                                                Name="textEditor"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                ContextMenu="{StaticResource TextEditorContextMenu}"
                                                FontFamily="微软雅黑"
                                                FontSize="{Binding SerialPort.TextFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Foreground="{DynamicResource Window.Foreground}"
                                                GotFocus="textBox_GotFocus"
                                                IsReadOnly="True"
                                                LostFocus="textBox_LostFocus"
                                                SyntaxHighlighting="ComLog"
                                                WordWrap="{Binding AutoWrap, Source={x:Static config:ConfigManager.Main}, Mode=OneWay}" />
                                        </Border>

                                        <StackPanel
                                            Grid.Row="0"
                                            Margin="30,20"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            Panel.ZIndex="99"
                                            Orientation="Vertical">

                                            <Border
                                                Width="25"
                                                Height="25"
                                                CornerRadius="5 5 0 0"
                                                MouseLeftButtonUp="GotoTop"
                                                Style="{StaticResource BgHoverBorder}"
                                                ToolTip="去到顶部">

                                                <Viewbox
                                                    Width="15"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        Data="M854.016 739.328l-313.344-309.248-313.344 309.248q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504q-29.696-28.672-29.696-68.608t29.696-68.608l376.832-373.76q14.336-14.336 34.304-22.528t40.448-9.216 39.424 5.12 31.232 20.48l382.976 379.904q28.672 28.672 28.672 68.608t-28.672 68.608q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504z"
                                                        Fill="{DynamicResource Window.Foreground}"
                                                        RenderTransformOrigin="0.5,0.5">
                                                        <Path.RenderTransform>
                                                            <TransformGroup>
                                                                <RotateTransform Angle="0" />
                                                            </TransformGroup>
                                                        </Path.RenderTransform>
                                                    </Path>
                                                </Viewbox>
                                            </Border>
                                            <Border
                                                Width="25"
                                                Height="25"
                                                Padding="3,8,0,0"
                                                Panel.ZIndex="99"
                                                CornerRadius="0 0 5 5"
                                                MouseLeftButtonUp="GotoBottom"
                                                Style="{StaticResource BgHoverBorder}"
                                                ToolTip="去到底部">

                                                <Viewbox
                                                    Width="15"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        Data="M854.016 739.328l-313.344-309.248-313.344 309.248q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504q-29.696-28.672-29.696-68.608t29.696-68.608l376.832-373.76q14.336-14.336 34.304-22.528t40.448-9.216 39.424 5.12 31.232 20.48l382.976 379.904q28.672 28.672 28.672 68.608t-28.672 68.608q-14.336 14.336-32.768 21.504t-37.376 7.168-36.864-7.168-32.256-21.504z"
                                                        Fill="{DynamicResource Window.Foreground}"
                                                        RenderTransformOrigin="0.5,0.5">
                                                        <Path.RenderTransform>
                                                            <TransformGroup>
                                                                <RotateTransform Angle="180" />
                                                            </TransformGroup>
                                                        </Path.RenderTransform>
                                                    </Path>
                                                </Viewbox>
                                            </Border>
                                        </StackPanel>

                                        <Border
                                            Grid.Row="1"
                                            Margin="0,5,5,0"
                                            Padding="0,3"
                                            Background="{DynamicResource Window.Side.Background}"
                                            CornerRadius="5"
                                            Tag="{Binding Name}">
                                            <StackPanel Orientation="Horizontal">
                                                <Button
                                                    Grid.Column="1"
                                                    MinWidth="70"
                                                    MinHeight="30"
                                                    Margin="5,0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Center"
                                                    Click="ConnectPort"
                                                    FontWeight="Bold"
                                                    Tag="{Binding Name}">
                                                    <Button.Style>
                                                        <Style BasedOn="{StaticResource FillButton}" TargetType="Button">
                                                            <Setter Property="Content" Value="连接" />
                                                            <Setter Property="Opacity" Value="1" />

                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Connected}" Value="True">

                                                                    <Setter Property="Content" Value="断开" />
                                                                    <Setter Property="Background" Value="Red" />
                                                                    <Setter Property="super:CommonExt.HoverBackground" Value="Red" />
                                                                </DataTrigger>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Opacity" Value="0.7" />
                                                                </Trigger>


                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                                <Button
                                                    MinWidth="70"
                                                    MinHeight="30"
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    super:CommonExt.CornerRadius="5"
                                                    Click="ClearData"
                                                    Content="清屏"
                                                    Style="{StaticResource ButtonDanger}"
                                                    ToolTip="清空窗口" />
                                                <ToggleButton
                                                    Name="pinToggleButton"
                                                    Width="auto"
                                                    Height="auto"
                                                    Margin="5,0"
                                                    Padding="2,2,4,2"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Center"
                                                    Background="Transparent"
                                                    Checked="pinToggleButton_Checked"
                                                    IsChecked="{Binding FixedText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource FlatToggleButton}"
                                                    ToolTip="固定/滚屏">
                                                    <Viewbox
                                                        Width="20"
                                                        Height="auto"
                                                        VerticalAlignment="Center">
                                                        <Path Data="M187.690667 874.709333h-0.277334a37.504 37.504 0 0 1-26.602666-11.264 37.845333 37.845333 0 0 1-3.904-49.877333l166.762666-229.76-125.013333-125.056a38.229333 38.229333 0 0 1-6.058667-46.336 140.8 140.8 0 0 1 53.504-45.674667 154.24 154.24 0 0 1 67.84-15.552 161.792 161.792 0 0 1 51.84 8.533334l6.4 0.661333c5.781333 0.405333 10.901333 0.981333 15.701334 1.749333a161.877333 161.877333 0 0 0 104.277333-47.253333 144.874667 144.874667 0 0 0 58.474667-90.346667c0-5.802667 0-11.904-0.234667-17.664a80.576 80.576 0 0 1 15.658667-74.858666A84.949333 84.949333 0 0 1 626.858667 106.666667a85.525333 85.525333 0 0 1 54.08 19.328l1.962666 1.941333c18.88 18.432 207.253333 206.933333 209.066667 208.746667A85.930667 85.930667 0 0 1 917.333333 397.888a85.973333 85.973333 0 0 1-25.6 61.205333 67.456 67.456 0 0 1-46.549333 16.874667 199.210667 199.210667 0 0 1-30.229333-3.008 226.176 226.176 0 0 0-15.701334-0.362667h-1.493333a115.605333 115.605333 0 0 0-77.930667 45.205334 210.752 210.752 0 0 0-59.456 118.976c0.917333 7.850667 2.56 21.333333 2.858667 23.125333a144.298667 144.298667 0 0 1-57.258667 165.056 38.229333 38.229333 0 0 1-20.138666 5.717333 38.058667 38.058667 0 0 1-27.093334-11.2l-123.562666-123.733333L209.92 866.986667a36.266667 36.266667 0 0 1-22.229333 7.722666z" Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                </ToggleButton>


                                                <Button
                                                    Width="27"
                                                    Height="27"
                                                    Margin="5,0"
                                                    Click="OpenPath"
                                                    Style="{StaticResource RoundNormalButton}"
                                                    ToolTip="打开当前日志所在文件夹">
                                                    <Viewbox
                                                        Width="20"
                                                        Height="20"
                                                        VerticalAlignment="Center">
                                                        <Path
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"
                                                            Data="M183.232 128c0 0-52.544 0 37.184 0 80.448 0 164.288 0 250.368 0 58.368 0 58.24 128.832 140.864 128.832 50.88 0 228.992 0 228.992 0C906.56 256.832 960 310.272 960 376.128l0 398.656c0 65.856-53.44 119.232-119.296 119.232L183.232 894.016C117.44 894.08 64 840.704 64 774.784L64 247.296C64 181.376 117.44 128 183.232 128z"
                                                            Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                </Button>
                                                <Button
                                                    Width="27"
                                                    Height="27"
                                                    Margin="5,0"
                                                    Click="OpenByDefaultApp"
                                                    Style="{StaticResource RoundNormalButton}"
                                                    ToolTip="用默认应用打开当前日志">
                                                    <Viewbox
                                                        Width="20"
                                                        Height="20"
                                                        VerticalAlignment="Center">
                                                        <Path
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"
                                                            Data="M565.8 887.6h-345v-751h361.6v187.1c0 19.9 16.1 36 36 36h187.4v115c0 19.9 16.1 36 36 36s36-16.1 36-36v-151c0-9.6-3.8-18.7-10.6-25.5L643.9 75.1c-0.6-0.6-1.2-1.1-1.8-1.6l-0.4-0.4-1.8-1.5s-0.1-0.1-0.2-0.1l-1.8-1.2-0.6-0.3c-0.6-0.4-1.3-0.8-2-1.1-0.1 0-0.2-0.1-0.2-0.1-0.6-0.3-1.2-0.6-1.9-0.9l-0.6-0.3c-0.7-0.3-1.4-0.6-2.1-0.8-0.1 0-0.1 0-0.2-0.1-0.7-0.2-1.4-0.5-2.1-0.7-0.2-0.1-0.4-0.1-0.6-0.2-0.7-0.2-1.5-0.4-2.3-0.5-0.7-0.1-1.5-0.3-2.3-0.4-0.2 0-0.4-0.1-0.6-0.1-0.7-0.1-1.4-0.2-2.2-0.2H202.1c-29.4 0-53.3 23.9-53.3 53.3v788.4c0 29.4 23.9 53.3 53.3 53.3h363.7c19.9 0 36-16.1 36-36s-16.1-36-36-36z m88.7-599.9V187.5l100.2 100.2H654.5z M921.6 870.7l-80.8-80.8c18.3-27.4 29-60.3 29-95.7 0-95-77-172.1-172.1-172.1-95 0-172.1 77-172.1 172.1 0 95 77 172.1 172.1 172.1 33.6 0 64.9-9.6 91.4-26.3l81.5 81.5c7 7 16.2 10.5 25.5 10.5s18.4-3.5 25.5-10.5c14.1-13.9 14.1-36.7 0-50.8zM597.7 694.3c0-55.2 44.9-100.1 100.1-100.1s100.1 44.9 100.1 100.1S753 794.4 697.8 794.4s-100.1-44.9-100.1-100.1z"
                                                            Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                </Button>


                                                <CheckBox
                                                    Margin="10"
                                                    VerticalAlignment="Center"
                                                    Content="加时间戳"
                                                    FontSize="15"
                                                    IsChecked="{Binding AddTimeStamp, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource NormalCheckBox}" />

                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5,0"
                                                    Padding="5"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Center"
                                                    IsChecked="{Binding RecvShowHex, Mode=TwoWay}"
                                                    Opacity="0.8">
                                                    <ToggleButton.Style>
                                                        <Style BasedOn="{StaticResource FlatToggleButton}" TargetType="ToggleButton">
                                                            <Setter Property="Content" Value="STR" />
                                                            <Setter Property="ToolTip" Value="当前模式：显示字符串" />
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Content" Value="HEX" />
                                                                    <Setter Property="ToolTip" Value="当前模式：显示十六进制" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>

                                                <Button
                                                    Margin="5,0"
                                                    Click="SaveToNewFile"
                                                    Content="日志立即分片" />

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="10,0"
                                                    Orientation="Horizontal">

                                                    <TextBox
                                                        MinWidth="100"
                                                        Background="Transparent"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        Style="{StaticResource ReadOnlyTextBox}"
                                                        Text="{Binding RX, Mode=OneWay, StringFormat=RX {0}}"
                                                        TextWrapping="NoWrap" />

                                                    <TextBox
                                                        MinWidth="100"
                                                        Background="Transparent"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        Style="{StaticResource ReadOnlyTextBox}"
                                                        Text="{Binding TX, Mode=OneWay, StringFormat=TX {0}}"
                                                        TextWrapping="NoWrap" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>

                                        <Grid
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            HorizontalAlignment="Right"
                                            Visibility="Collapsed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>

                                            <Grid />

                                            <StackPanel Orientation="Vertical" Visibility="Collapsed">
                                                <ToggleButton
                                                    Margin="0"
                                                    super:CommonExt.CornerRadius="0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    BorderThickness="0,0,2,0"
                                                    SnapsToDevicePixels="True"
                                                    Style="{StaticResource FlatToggleButton}">
                                                    <ToggleButton.Content>
                                                        <StackPanel Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="过" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="滤" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="器" />
                                                        </StackPanel>
                                                    </ToggleButton.Content>
                                                </ToggleButton>
                                                <ToggleButton
                                                    Margin="0"
                                                    super:CommonExt.CornerRadius="0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    BorderThickness="0,0,2,0"
                                                    SnapsToDevicePixels="True"
                                                    Style="{StaticResource FlatToggleButton}">
                                                    <ToggleButton.Content>
                                                        <StackPanel Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="监" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="视" />
                                                            <TextBlock
                                                                Margin="0"
                                                                FontSize="10"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="器" />
                                                        </StackPanel>
                                                    </ToggleButton.Content>
                                                </ToggleButton>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>

                                    <Grid
                                        Name="advancedGrid"
                                        Grid.Row="0"
                                        Height="250"
                                        Margin="250,0,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Bottom"
                                        Panel.ZIndex="10"
                                        Visibility="Hidden">
                                        <Border
                                            Margin="5"
                                            Background="{DynamicResource Menu.Background}"
                                            CornerRadius="5"
                                            Effect="{StaticResource PopupDropShadowEffect}" />
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="auto" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="2" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel
                                                Grid.Row="0"
                                                Margin="10"
                                                Orientation="Vertical">
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="编码"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        Width="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.Encodings, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.PortEncoding, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.PortEncoding" />
                                                                            <Binding Path="DataContext.Encodings" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="Parity"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        Width="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.Parities, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.ParityString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.ParityString" />
                                                                            <Binding Path="DataContext.Paritys" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="StopBits"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        Width="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.StopBits, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.StopBitsString, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.StopBitsString" />
                                                                            <Binding Path="DataContext.StopBits" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="DTR"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.DtrEnable, Mode=TwoWay}" />
                                                    <Border
                                                        Width="25"
                                                        Height="25"
                                                        Margin="0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        Background="Transparent"
                                                        ToolTip="Data Terminal Ready, 通信控制信号&#x0a;更多请访问顶部菜单栏：高级——文献——Serial and UART Tutorial">
                                                        <Viewbox Width="auto" Height="14">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M512 128c212 0 384 172 384 384s-172 384-384 384-384-172-384-384 172-384 384-384m0-64C264.8 64 64 264.8 64 512s200.8 448 448 448 448-200.8 448-448S759.2 64 512 64z m32 192h-64v64h64v-64z m0 448V384h-32.8L384 418.4l16.8 61.6 79.2-21.6V704H384v64h256v-64H544z"
                                                                Fill="{DynamicResource Window.Foreground}" />
                                                        </Viewbox>
                                                    </Border>
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="RTS"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.RtsEnable, Mode=TwoWay}">
                                                        <!--<super:Switch.Style>
                                                            <Style TargetType="{x:Type super:Switch}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SerialPort.Handshake}" Value="2">
                                                                        <Setter Property="IsEnabled" Value="False" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SerialPort.Handshake}" Value="3">
                                                                        <Setter Property="IsEnabled" Value="False" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </super:Switch.Style>-->
                                                    </super:Switch>
                                                    <Border
                                                        Width="25"
                                                        Height="25"
                                                        Margin="0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        Background="Transparent"
                                                        ToolTip="Request to Send， 流量控制机制&#x0a;更多请访问顶部菜单栏：高级——文献——Serial and UART Tutorial">
                                                        <Viewbox Width="auto" Height="14">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M512 128c212 0 384 172 384 384s-172 384-384 384-384-172-384-384 172-384 384-384m0-64C264.8 64 64 264.8 64 512s200.8 448 448 448 448-200.8 448-448S759.2 64 512 64z m32 192h-64v64h64v-64z m0 448V384h-32.8L384 418.4l16.8 61.6 79.2-21.6V704H384v64h256v-64H544z"
                                                                Fill="{DynamicResource Window.Foreground}" />
                                                        </Viewbox>
                                                    </Border>
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}"
                                                    Visibility="Collapsed">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="中断"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsEnabled="{Binding Connected}" />
                                                    <Border
                                                        Width="25"
                                                        Height="25"
                                                        Margin="0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        Background="Transparent"
                                                        ToolTip="中断信号状态发生在传输暂停时，线路处于中断状态（全低，无停止位）直到被释放">
                                                        <Viewbox Width="auto" Height="14">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M512 128c212 0 384 172 384 384s-172 384-384 384-384-172-384-384 172-384 384-384m0-64C264.8 64 64 264.8 64 512s200.8 448 448 448 448-200.8 448-448S759.2 64 512 64z m32 192h-64v64h64v-64z m0 448V384h-32.8L384 418.4l16.8 61.6 79.2-21.6V704H384v64h256v-64H544z"
                                                                Fill="{DynamicResource Window.Foreground}" />
                                                        </Viewbox>
                                                    </Border>
                                                </StackPanel>

                                            </StackPanel>

                                            <Rectangle
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                Width="2"
                                                Margin="0,20"
                                                Fill="{DynamicResource Window.Sub.Foreground}"
                                                RadiusX="2"
                                                RadiusY="2" />

                                            <StackPanel
                                                Grid.Row="0"
                                                Grid.Column="2"
                                                Margin="10"
                                                Orientation="Vertical">


                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="读超时"
                                                        TextAlignment="Right" />
                                                    <super:SearchBox
                                                        Width="100"
                                                        Height="30"
                                                        VerticalAlignment="Center"
                                                        FontSize="10"
                                                        ShowClearButton="False"
                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                        Text="{Binding SerialPort.ReadTimeoutValue, Mode=TwoWay}"
                                                        TextAlignment="Center"
                                                        TextChanged="OnPortSettingChanged" />
                                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="写超时"
                                                        TextAlignment="Right" />
                                                    <super:SearchBox
                                                        Width="100"
                                                        Height="30"
                                                        VerticalAlignment="Center"
                                                        FontSize="10"
                                                        ShowClearButton="False"
                                                        Style="{StaticResource SearchTextBoxStyle}"
                                                        Text="{Binding SerialPort.WriteTimeoutValue, Mode=TwoWay}"
                                                        TextAlignment="Center"
                                                        TextChanged="OnPortSettingChanged" />
                                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5,0"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="握手"
                                                        TextAlignment="Right" />
                                                    <ComboBox
                                                        Width="120"
                                                        VerticalAlignment="Center"
                                                        FontSize="12"
                                                        ItemsSource="{Binding DataContext.HandShakes, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                        SelectionChanged="OnPortSettingChanged"
                                                        Text="{Binding SerialPort.Handshake, Mode=TwoWay}">
                                                        <ComboBox.Style>
                                                            <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                                <Setter Property="SelectedIndex">
                                                                    <Setter.Value>
                                                                        <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                            <Binding Path="SerialPort.Handshake" />
                                                                            <Binding Path="DataContext.HandShakes" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                        </MultiBinding>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ComboBox.Style>
                                                    </ComboBox>
                                                </StackPanel>

                                                <StackPanel
                                                    Margin="5"
                                                    Orientation="Horizontal"
                                                    Tag="{Binding Name}">
                                                    <TextBlock
                                                        Width="60"
                                                        FontSize="12"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="忽略空字符"
                                                        TextAlignment="Right" />
                                                    <super:Switch
                                                        Height="20"
                                                        Margin="5,0"
                                                        Background="{DynamicResource Window.Title.Background}"
                                                        Click="OnPortSettingChanged"
                                                        IsChecked="{Binding SerialPort.DiscardNull, Mode=TwoWay}" />
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel
                                                Grid.Row="1"
                                                Grid.ColumnSpan="3"
                                                Margin="0,0,0,20"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Bottom"
                                                Orientation="Horizontal"
                                                Tag="{Binding Name}">
                                                <Button
                                                    Click="HideAdvancedGrid"
                                                    Content="关闭"
                                                    Style="{StaticResource ButtonDanger}" />
                                                <Button
                                                    Click="RestorePortSetting"
                                                    Content="恢复默认"
                                                    Style="{StaticResource ButtonPrimary}"
                                                    Visibility="Collapsed" />
                                            </StackPanel>
                                        </Grid>

                                    </Grid>




                                    <GridSplitter
                                        Grid.Row="1"
                                        Height="4"
                                        HorizontalAlignment="Stretch"
                                        Panel.ZIndex="10"
                                        Style="{StaticResource HoverSpliter}" />

                                    <Grid Grid.Row="2">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <Border
                                            Grid.Row="0"
                                            Margin="0,0,5,0"
                                            Padding="5,0"
                                            Background="{DynamicResource Window.Title.Background}"
                                            CornerRadius="5">
                                            <WrapPanel Orientation="Horizontal" Tag="{Binding Name}">
                                                <TextBlock
                                                    FontSize="12"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="波特率" />
                                                <ComboBox
                                                    x:Name="baudRateComboBox"
                                                    MinWidth="120"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    ItemsSource="{Binding DataContext.BaudRates, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectionChanged="BaudRate_SelectionChanged"
                                                    Tag="{Binding Name}"
                                                    Text="{Binding SerialPort.BaudRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                    <ComboBox.Style>
                                                        <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                            <Setter Property="SelectedIndex">
                                                                <Setter.Value>
                                                                    <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                        <Binding Path="SerialPort.BaudRate" />
                                                                        <Binding Path="DataContext.BaudRates" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                    </MultiBinding>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ComboBox.Style>
                                                </ComboBox>
                                                <TextBlock
                                                    FontSize="12"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="数据位" />
                                                <ComboBox
                                                    MinWidth="70"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    ItemsSource="{Binding DataContext.DataBits, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectionChanged="OnPortSettingChanged"
                                                    Text="{Binding SerialPort.DataBits, Mode=TwoWay}">
                                                    <ComboBox.Style>
                                                        <Style BasedOn="{StaticResource BorderComboBox}" TargetType="ComboBox">
                                                            <Setter Property="SelectedIndex">
                                                                <Setter.Value>
                                                                    <MultiBinding Converter="{StaticResource ComboBoxSelectedIndexConverter}" Mode="OneWay">
                                                                        <Binding Path="SerialPort.DataBits" />
                                                                        <Binding Path="DataContext.DataBits" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}" />
                                                                    </MultiBinding>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ComboBox.Style>
                                                </ComboBox>
                                                <Button
                                                    Margin="5"
                                                    VerticalAlignment="Center"
                                                    Click="ShowAdvancedOptions"
                                                    Content="更多串口设置" />


                                                <TextBlock
                                                    Margin="10,0,5,0"
                                                    HorizontalAlignment="Left"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="语法高亮" />

                                                <ComboBox
                                                    Name="highlightingComboBox"
                                                    Width="130"
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    ItemsSource="{Binding DataContext.HighlightingDefinitions, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                                                    SelectedIndex="{Binding SerialPort.HighLightIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    SelectionChanged="highlightingComboBox_SelectionChanged"
                                                    Style="{StaticResource BorderComboBox}"
                                                    Tag="{Binding Name}" />
                                                <Button
                                                    Margin="5,0"
                                                    BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                    Click="ShowHighLightEdit"
                                                    Content="编辑"
                                                    FontSize="10"
                                                    Style="{StaticResource BorderButton}" />

                                                <super:Switch
                                                    Height="20"
                                                    VerticalAlignment="Center"
                                                    Background="{DynamicResource Window.Title.Background}"
                                                    IsChecked="{Binding EnabledFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    Visibility="Collapsed" />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="过滤器"
                                                    ToolTip="过滤规则同语法高亮"
                                                    Visibility="Collapsed" />

                                            </WrapPanel>
                                        </Border>

                                        <Border
                                            Name="sendBorder"
                                            Grid.Row="1"
                                            Margin="0,5,5,0"
                                            Padding="5,0"
                                            Background="{DynamicResource Window.Title.Background}"
                                            CornerRadius="5"
                                            Tag="{Binding Name}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel
                                                    Grid.Column="0"
                                                    VerticalAlignment="Top"
                                                    Orientation="Horizontal">


                                                    <Button
                                                        Margin="5,0"
                                                        VerticalAlignment="Center"
                                                        Click="OpenSendPanel"
                                                        Content="编辑命令"
                                                        IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}"
                                                        Tag="{Binding ElementName=commandsComboBox, Path=SelectedIndex}" />

                                                    <Button
                                                        Width="25"
                                                        Height="25"
                                                        Margin="0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        super:CommonExt.CornerRadius="5"
                                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                        Click="StartSendCommands"
                                                        Style="{StaticResource FlatButton}"
                                                        Tag="{Binding Name}">
                                                        <Viewbox
                                                            Width="12"
                                                            Height="auto"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M128 138.666667c0-47.232 33.322667-66.666667 74.176-43.562667l663.146667 374.954667c40.96 23.168 40.853333 60.8 0 83.882666L202.176 928.896C161.216 952.064 128 932.565333 128 885.333333v-746.666666z"
                                                                Effect="{StaticResource PopupDropShadowEffect}">
                                                                <Path.Style>
                                                                    <Style TargetType="Path">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="False">
                                                                                <Setter Property="Fill" Value="Gray" />
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="True">
                                                                                <Setter Property="Fill" Value="#99E699" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </Viewbox>
                                                    </Button>

                                                    <Button
                                                        Width="25"
                                                        Height="25"
                                                        Margin="5,0"
                                                        Padding="0"
                                                        VerticalAlignment="Stretch"
                                                        super:CommonExt.CornerRadius="5"
                                                        super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                        Click="StopSendCommands"
                                                        IsEnabled="False"
                                                        Style="{StaticResource FlatButton}"
                                                        Tag="{Binding Name}">

                                                        <Viewbox
                                                            Width="12"
                                                            Height="auto"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Center">
                                                            <Path
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Data="M128 128m53.333333 0l661.333334 0q53.333333 0 53.333333 53.333333l0 661.333334q0 53.333333-53.333333 53.333333l-661.333334 0q-53.333333 0-53.333333-53.333333l0-661.333334q0-53.333333 53.333333-53.333333Z"
                                                                Effect="{StaticResource PopupDropShadowEffect}">
                                                                <Path.Style>
                                                                    <Style TargetType="Path">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="False">
                                                                                <Setter Property="Fill" Value="Gray" />
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Value="True">
                                                                                <Setter Property="Fill" Value="#C85860" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>
                                                        </Viewbox>
                                                    </Button>
                                                    <ComboBox
                                                        Name="commandsComboBox"
                                                        MinWidth="50"
                                                        VerticalAlignment="Center"
                                                        DisplayMemberPath="ProjectName"
                                                        IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}"
                                                        ItemsSource="{Binding Path=DataContext.SendCommandProjects, RelativeSource={RelativeSource AncestorType={x:Type super:BaseWindow}}}"
                                                        SelectedIndex="{Binding CommandsSelectIndex, Mode=OneWay}"
                                                        SelectedValuePath="ProjectID"
                                                        SelectionChanged="ComboBox_SelectionChanged"
                                                        Style="{StaticResource BorderComboBox}" />
                                                </StackPanel>
                                                <ItemsControl
                                                    Grid.Column="3"
                                                    Margin="5,0"
                                                    IsEnabled="{Binding RunningCommands, Converter={StaticResource OppositeBooleanConverter}}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel VerticalAlignment="Center" Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Button
                                                                Margin="5"
                                                                VerticalAlignment="Center"
                                                                BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                                                Click="SendCustomCommand"
                                                                Content="{Binding Name, TargetNullValue=发送命令}"
                                                                PreviewMouseRightButtonUp="Button_PreviewMouseRightButtonUp"
                                                                Style="{StaticResource BorderButton}"
                                                                Tag="{Binding CommandID}"
                                                                ToolTip="{Binding Command}">
                                                                <Button.ContextMenu>
                                                                    <ContextMenu>
                                                                        <MenuItem Click="EditSendCommand" Header="编辑" />
                                                                        <MenuItem
                                                                            super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Deep.Background}"
                                                                            Click="DeleteSendCommand"
                                                                            Header="删除" />
                                                                    </ContextMenu>
                                                                </Button.ContextMenu>
                                                            </Button>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>


                                            </Grid>
                                        </Border>


                                        <Grid
                                            Grid.Row="2"
                                            MinHeight="100"
                                            Tag="{Binding Name, Mode=OneWay}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="100" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" Margin="6">
                                                <ToggleButton
                                                    Margin="0"
                                                    Padding="5"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Bottom"
                                                    Click="ToggleButton_Click"
                                                    Opacity="0.8"
                                                    Style="{StaticResource FlatToggleButton}"
                                                    ToolTip="文本框过长时换行显示"
                                                    Visibility="Collapsed">
                                                    <Viewbox
                                                        Width="15"
                                                        Height="auto"
                                                        VerticalAlignment="Center">
                                                        <Viewbox
                                                            Width="15"
                                                            Height="auto"
                                                            VerticalAlignment="Center">
                                                            <Path Data="M896 160C896 177.664 881.664 192 864 192l-768 0C78.336 192 64 177.664 64 160l0 0C64 142.336 78.336 128 96 128l768 0C881.664 128 896 142.336 896 160L896 160zM896 352C896 334.336 881.664 320 864 320l-768 0C78.336 320 64 334.336 64 352l0 0C64 369.664 78.336 384 96 384l768 0C881.664 384 896 369.664 896 352L896 352zM384 736C384 718.336 369.664 704 352 704l-256 0C78.336 704 64 718.336 64 736l0 0C64 753.664 78.336 768 96 768l256 0C369.664 768 384 753.664 384 736L384 736zM735.168 512 732.8 512 599.232 512 96 512C78.336 512 64 526.336 64 544S78.336 576 96 576l503.232 0 133.568 0 2.368 0c52.928 0 96 43.072 96 96s-43.072 96-96 96L568.96 768l0-2.112L568.576 765.888l64.128-64.128c12.8-12.8 12.8-33.664 0-46.528-12.864-12.864-33.6-12.864-46.528 0l-120.192 120.192c-6.208 6.208-9.6 14.592-9.6 23.296 0 8.704 3.456 17.024 9.6 23.232l120.192 120.128c12.864 12.736 33.6 12.736 46.528 0 12.864-12.864 12.864-33.6 0-46.592L569.024 832l166.208 0c88.256 0 160-71.744 160-160S823.424 512 735.168 512z" Fill="{DynamicResource Window.Foreground}" />
                                                        </Viewbox>
                                                    </Viewbox>
                                                </ToggleButton>
                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5"
                                                    Padding="5"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Bottom"
                                                    IsChecked="{Binding AddNewLineWhenWrite, Mode=TwoWay}"
                                                    Opacity="0.8"
                                                    Style="{StaticResource FlatToggleButton}"
                                                    ToolTip="发送时加回车换行">
                                                    <Viewbox
                                                        Width="15"
                                                        Height="auto"
                                                        VerticalAlignment="Center">
                                                        <Viewbox
                                                            Width="15"
                                                            Height="auto"
                                                            VerticalAlignment="Center">
                                                            <Path Data="M896 160C896 177.664 881.664 192 864 192l-768 0C78.336 192 64 177.664 64 160l0 0C64 142.336 78.336 128 96 128l768 0C881.664 128 896 142.336 896 160L896 160zM896 352C896 334.336 881.664 320 864 320l-768 0C78.336 320 64 334.336 64 352l0 0C64 369.664 78.336 384 96 384l768 0C881.664 384 896 369.664 896 352L896 352zM384 736C384 718.336 369.664 704 352 704l-256 0C78.336 704 64 718.336 64 736l0 0C64 753.664 78.336 768 96 768l256 0C369.664 768 384 753.664 384 736L384 736zM735.168 512 732.8 512 599.232 512 96 512C78.336 512 64 526.336 64 544S78.336 576 96 576l503.232 0 133.568 0 2.368 0c52.928 0 96 43.072 96 96s-43.072 96-96 96L568.96 768l0-2.112L568.576 765.888l64.128-64.128c12.8-12.8 12.8-33.664 0-46.528-12.864-12.864-33.6-12.864-46.528 0l-120.192 120.192c-6.208 6.208-9.6 14.592-9.6 23.296 0 8.704 3.456 17.024 9.6 23.232l120.192 120.128c12.864 12.736 33.6 12.736 46.528 0 12.864-12.864 12.864-33.6 0-46.592L569.024 832l166.208 0c88.256 0 160-71.744 160-160S823.424 512 735.168 512z" Fill="{DynamicResource Window.Foreground}" />
                                                        </Viewbox>
                                                    </Viewbox>
                                                </ToggleButton>
                                                <ToggleButton
                                                    MinWidth="40"
                                                    Margin="5"
                                                    Padding="5"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Bottom"
                                                    IsChecked="{Binding SendHex, Mode=TwoWay}"
                                                    Opacity="0.8">
                                                    <ToggleButton.Style>
                                                        <Style BasedOn="{StaticResource FlatToggleButton}" TargetType="ToggleButton">
                                                            <Setter Property="Content" Value="STR" />
                                                            <Setter Property="ToolTip" Value="当前模式：发送字符串" />
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Content" Value="HEX" />
                                                                    <Setter Property="ToolTip" Value="当前模式：发送十六进制" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>
                                            </StackPanel>
                                            <Border
                                                Grid.Column="1"
                                                Margin="0,5"
                                                Background="{DynamicResource Window.Side.Background}"
                                                BorderThickness="1"
                                                CornerRadius="5">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding ElementName=sendTextBox, Path=IsFocused}" Value="True">
                                                                <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="*" />
                                                        <RowDefinition Height="auto" />
                                                    </Grid.RowDefinitions>
                                                    <TextBox
                                                        Name="sendTextBox"
                                                        Grid.Row="0"
                                                        Margin="10"
                                                        VerticalAlignment="Stretch"
                                                        AcceptsReturn="False"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        CaretBrush="{DynamicResource Window.Foreground}"
                                                        ContextMenu="{StaticResource TextBoxContextMenu}"
                                                        Foreground="{DynamicResource Window.Foreground}"
                                                        PreviewKeyDown="SendTextBox_PreviewKeyDown"
                                                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                        Tag="{Binding Name, Mode=OneWay}"
                                                        Text="{Binding WriteData, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                        TextChanged="SendTextBox_TextChanged"
                                                        TextWrapping="Wrap" />
                                                    <Border Grid.Row="1" Margin="0">
                                                        <Border.Style>
                                                            <Style BasedOn="{StaticResource InfoBorder}" TargetType="Border">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SendHex}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <TextBox
                                                            Margin="0"
                                                            FontSize="10"
                                                            Style="{StaticResource ReadOnlyNoWrapTextBox}"
                                                            Text="{Binding SendHexValue}" />
                                                    </Border>
                                                </Grid>
                                            </Border>

                                            <Popup
                                                x:Name="sendHistoryPopup"
                                                Width="420"
                                                Height="auto"
                                                AllowsTransparency="True"
                                                HorizontalOffset="-10"
                                                Placement="Top"
                                                PlacementTarget="{Binding ElementName=sendTextBox}"
                                                PopupAnimation="Fade"
                                                StaysOpen="False"
                                                Tag="{Binding Name, Mode=OneWay}"
                                                VerticalOffset="-10">
                                                <Grid MaxHeight="600" Margin="5">
                                                    <Border
                                                        Margin="5"
                                                        Background="{DynamicResource Menu.Background}"
                                                        Effect="{StaticResource PopupDropShadowEffect}" />
                                                    <ScrollViewer
                                                        Width="390"
                                                        Margin="0,10"
                                                        HorizontalScrollBarVisibility="Hidden"
                                                        VerticalScrollBarVisibility="auto">
                                                        <ItemsControl
                                                            Name="itemsControl"
                                                            Margin="0,5"
                                                            Background="Transparent">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <StackPanel />
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border
                                                                        x:Name="baseBorder"
                                                                        Margin="5,0"
                                                                        HorizontalAlignment="Stretch"
                                                                        BorderBrush="Transparent"
                                                                        BorderThickness="1"
                                                                        MouseEnter="HistoryMouseEnter"
                                                                        MouseLeave="HistoryMouseLeave"
                                                                        MouseLeftButtonDown="SetSendHistory"
                                                                        Style="{StaticResource HoverBorder}">
                                                                        <Grid>
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="*" />
                                                                                <ColumnDefinition Width="auto" />
                                                                            </Grid.ColumnDefinitions>
                                                                            <TextBlock
                                                                                Grid.Column="0"
                                                                                Style="{StaticResource BaseTextBlock}"
                                                                                Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}"
                                                                                Text="{Binding Path=.}"
                                                                                TextAlignment="Left"
                                                                                TextTrimming="WordEllipsis"
                                                                                TextWrapping="NoWrap" />
                                                                            <Border
                                                                                Grid.Column="1"
                                                                                Background="Transparent"
                                                                                BorderBrush="{StaticResource TabItem.Selected.Background}"
                                                                                Tag="{Binding Path=.}">
                                                                                <Button
                                                                                    Width="20"
                                                                                    Height="20"
                                                                                    Margin="5"
                                                                                    HorizontalAlignment="Right"
                                                                                    Click="DeleteSendHistory"
                                                                                    Style="{StaticResource RoundNormalButton}"
                                                                                    Tag="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Popup}}}"
                                                                                    Visibility="Visible">
                                                                                    <Viewbox
                                                                                        Width="10"
                                                                                        Height="auto"
                                                                                        VerticalAlignment="Center">
                                                                                        <Path
                                                                                            HorizontalAlignment="Center"
                                                                                            VerticalAlignment="Center"
                                                                                            Data="M610.218667 505.6l398.08-387.413333a49.664 49.664 0 0 0 0-71.338667l-2.133334-2.133333a52.992 52.992 0 0 0-73.301333 0L534.784 432.64 136.704 44.373333a52.992 52.992 0 0 0-73.386667 0L61.269333 46.592a48.810667 48.810667 0 0 0 0 71.338667l398.165334 387.669333-398.165334 387.498667a49.664 49.664 0 0 0 0 71.253333l2.218667 2.133333c20.48 19.626667 52.821333 19.626667 73.301333 0l398.08-387.413333 398.08 387.413333c20.48 19.626667 52.906667 19.626667 73.386667 0l2.048-2.133333a49.664 49.664 0 0 0 0-71.253333l-398.08-387.413334z"
                                                                                            Fill="{DynamicResource TabItem.Hover.Foreground}" />
                                                                                    </Viewbox>
                                                                                </Button>
                                                                            </Border>
                                                                        </Grid>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </ScrollViewer>
                                                </Grid>
                                            </Popup>

                                            <Grid Grid.Column="2">



                                                <Button
                                                    Margin="5,5,7,5"
                                                    Padding="10"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Bottom"
                                                    Click="SendCommand"
                                                    Content="发送"
                                                    Tag="{Binding Name}" />
                                            </Grid>


                                        </Grid>

                                    </Grid>
                                </Grid>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>


            </Grid>

            <Grid
                Grid.Row="1"
                Height="25"
                Background="{DynamicResource Window.StatusBar.Background}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <Border
                    Margin="5,0"
                    Padding="10,0"
                    VerticalAlignment="Stretch"
                    super:CommonExt.HoverBackground="{DynamicResource Button.Hover.Background}"
                    CornerRadius="0"
                    Style="{StaticResource HoverBorder}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" Text="{Binding MemoryUsed, StringFormat={}内存 {0}\ MB}" />
                        <TextBlock
                            Margin="10,0"
                            VerticalAlignment="Center"
                            Text="{Binding CpuUsed, StringFormat={}CPU {0}\ %}" />
                    </StackPanel>
                </Border>


            </Grid>

        </Grid>

    </Grid>
</super:BaseWindow>
